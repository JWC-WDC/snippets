<?php
require 'nav.php'; // stops code if nav file is missing

// Setup empty variables
$name = "";
$email = "";
$message = "";
$errors = [];

// When form is submitted
if ($_SERVER["REQUEST_METHOD"] === "POST") {

    // --- SANITIZE ---

    // Note: trim removes whitespace from the beginning and end

    // htmlspecialchars converts special characters to HTML entities (for security)

    // more about htmlspecialchars: https://chatgpt.com/share/67fd4dd4-8520-800e-87e4-c2abd62d63e1

    $name = htmlspecialchars(trim($_POST["name"] ?? ""), ENT_QUOTES);

    $email = filter_var(trim($_POST["email"] ?? ""), FILTER_SANITIZE_EMAIL);

    $message = htmlspecialchars(trim($_POST["message"] ?? ""), ENT_QUOTES);

    // --- VALIDATE ---

    // strlen = number of characters in a string. Below you see a minimum of 2 characters required.

    // Name required, at least 2 chars
    if ($name === "" || strlen($name) < 2) {
        $errors["name"] = "Please enter your name (2+ characters).";
    }

    // Email required and must be valid
    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $errors["email"] = "Please enter a valid email address.";
    }

    // Message required
    if ($message === "") {
        $errors["message"] = "Message cannot be empty.";
    }

    // If no errors: show cleaned data
    if (empty($errors)) {
        echo "<h2>Form submitted successfully!</h2>";
        echo "<p><strong>Name:</strong> $name</p>";
        echo "<p><strong>Email:</strong> $email</p>";
        echo "<p><strong>Message:</strong> $message</p>";
        exit;
    }
}
?>

<style>
    /* hard-coded CSS for demo purposes only */

    * {
        padding: .15rem;
    }

    .error {
        color: red;
    }

    input {
        margin-bottom: 1rem;
    }

    ul {
        list-style: none;
    }
</style>

<h1>Basic PHP Form</h1>

<form method="post">

    <label>Name:
        <input type="text" name="name" value="<?php echo $name; ?>">
    </label>
    <?php if (isset($errors["name"])) echo "<p style='color:red'>{$errors["name"]}</p>"; ?>

    <br><br>

    <label>Email:
        <input type="text" name="email" value="<?php echo $email; ?>">
    </label>
    <?php if (isset($errors["email"])) echo "<p style='color:red'>{$errors["email"]}</p>"; ?>

    <br><br>

    <label>Message:
        <textarea name="message"><?php echo $message; ?></textarea>
    </label>
    <?php if (isset($errors["message"])) echo "<p style='color:red'>{$errors["message"]}</p>"; ?>

    <br><br>

    <button type="submit">Send</button>
</form>

</body>
</html>
